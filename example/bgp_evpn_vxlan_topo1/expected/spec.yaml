nodes:
  - name: host1
    image: quay.io/frrouting/frr:8.5.0
    interfaces: [{name: net0, type: direct, args: s1#net0}]
    mounts: [host1/zebra.conf:/etc/frr/zebra.conf, host1/daemons:/etc/frr/daemons, host1/vtysh.conf:/etc/frr/vtysh.conf, host1/frr.log:/var/log/frr.log]
  - name: host2
    image: quay.io/frrouting/frr:8.5.0
    interfaces: [{name: net0, type: direct, args: s4#net0}]
    mounts: [host2/zebra.conf:/etc/frr/zebra.conf, host2/daemons:/etc/frr/daemons, host2/vtysh.conf:/etc/frr/vtysh.conf, host2/frr.log:/var/log/frr.log]
  - name: p1
    image: quay.io/frrouting/frr:8.5.0
    interfaces: [{name: net0, type: direct, args: s2#net0}, {name: net1, type: direct, args: s3#net0}]
    mounts: [p1/zebra.conf:/etc/frr/zebra.conf, p1/ospfd.conf:/etc/frr/ospfd.conf, p1/daemons:/etc/frr/daemons, p1/vtysh.conf:/etc/frr/vtysh.conf, p1/frr.log:/var/log/frr.log]
  - name: pe1
    image: quay.io/frrouting/frr:8.5.0
    interfaces: [{name: net0, type: direct, args: s1#net1}, {name: net1, type: direct, args: s2#net1}]
    mounts: [pe1/zebra.conf:/etc/frr/zebra.conf, pe1/bgpd.conf:/etc/frr/bgpd.conf, pe1/ospfd.conf:/etc/frr/ospfd.conf, pe1/daemons:/etc/frr/daemons, pe1/vtysh.conf:/etc/frr/vtysh.conf, pe1/frr.log:/var/log/frr.log]
  - name: pe2
    image: quay.io/frrouting/frr:8.5.0
    interfaces: [{name: net0, type: direct, args: s3#net1}, {name: net1, type: direct, args: s4#net1}]
    mounts: [pe2/zebra.conf:/etc/frr/zebra.conf, pe2/bgpd.conf:/etc/frr/bgpd.conf, pe2/ospfd.conf:/etc/frr/ospfd.conf, pe2/daemons:/etc/frr/daemons, pe2/vtysh.conf:/etc/frr/vtysh.conf, pe2/frr.log:/var/log/frr.log]
  - name: s1
    image: nicolaka/netshoot
    interfaces: [{name: net0, type: direct, args: host1#net0}, {name: net1, type: direct, args: pe1#net0}]
    mounts: []
  - name: s2
    image: nicolaka/netshoot
    interfaces: [{name: net0, type: direct, args: p1#net0}, {name: net1, type: direct, args: pe1#net1}]
    mounts: []
  - name: s3
    image: nicolaka/netshoot
    interfaces: [{name: net0, type: direct, args: p1#net1}, {name: net1, type: direct, args: pe2#net0}]
    mounts: []
  - name: s4
    image: nicolaka/netshoot
    interfaces: [{name: net0, type: direct, args: host2#net0}, {name: net1, type: direct, args: pe2#net1}]
    mounts: []

node_configs:
  - name: host1
    cmds:
      - cmd: chown frr:frr /var/log/frr.log
  - name: host2
    cmds:
      - cmd: chown frr:frr /var/log/frr.log
  - name: p1
    cmds:
      - cmd: chown frr:frr /var/log/frr.log
      - cmd: sysctl -w net.ipv4.ip_forward=1
  - name: pe1
    cmds:
      - cmd: chown frr:frr /var/log/frr.log
      - cmd: sysctl -w net.ipv4.ip_forward=1
  - name: pe2
    cmds:
      - cmd: chown frr:frr /var/log/frr.log
      - cmd: sysctl -w net.ipv4.ip_forward=1
  - name: s1
    cmds:
      - cmd: ip link add br0 type bridge
      - cmd: ip link set br0 up
      - cmd: ip link set dev net0 promisc on
      - cmd: ip link set dev net0 master br0
      - cmd: ip link set dev net1 promisc on
      - cmd: ip link set dev net1 master br0
  - name: s2
    cmds:
      - cmd: ip link add br0 type bridge
      - cmd: ip link set br0 up
      - cmd: ip link set dev net0 promisc on
      - cmd: ip link set dev net0 master br0
      - cmd: ip link set dev net1 promisc on
      - cmd: ip link set dev net1 master br0
  - name: s3
    cmds:
      - cmd: ip link add br0 type bridge
      - cmd: ip link set br0 up
      - cmd: ip link set dev net0 promisc on
      - cmd: ip link set dev net0 master br0
      - cmd: ip link set dev net1 promisc on
      - cmd: ip link set dev net1 master br0
  - name: s4
    cmds:
      - cmd: ip link add br0 type bridge
      - cmd: ip link set br0 up
      - cmd: ip link set dev net0 promisc on
      - cmd: ip link set dev net0 master br0
      - cmd: ip link set dev net1 promisc on
      - cmd: ip link set dev net1 master br0