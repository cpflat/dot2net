name: test

module:
  - tinet
  - containerlab

layer:
  - name: ip
    default_connect: true
    policy:
      - name: ip
        range: 10.0.0.0/16
        prefix: 24

nodeclass:
  - name: switch
    values:
      kind: linux
      image: nicolaka/netshoot
    config:
      - name: startup
        blocks:
          after: ["interfaces_link"]
        template:
          - "ip link add br0 type bridge"
          - "ip link set br0 up"

  - name: server
    interface_policy: [ip]
    values:
      kind: linux
      image: nicolaka/netshoot
    config:
      - name: startup
        blocks:
          after: ["interfaces_addr"]
        template: []

interfaceclass:
  - name: default
    config:
      - name: link
        node: switch
        template:
          - ip link set dev {{ .name }} promisc on
          - ip link set dev {{ .name }} master br0
      - name: addr
        node: server
        template:
          - ip addr add {{ .ip_addr }}/{{ .ip_plen }} dev {{ .name }}

